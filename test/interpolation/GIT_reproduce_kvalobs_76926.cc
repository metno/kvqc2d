
#include "GapInterpolationTestBase.hh"

TEST_F(GapInterpolationTest, reproduce_kvalobs_76926)
{
    std::ostringstream sql;
    INSERT_STATION(sql, 76926, "SLEIPNER A",                  58.400,  1.900,   85);
    ASSERT_NO_THROW_X(db->exec(sql.str()));
    DataList data(76926, 211, 11);
    data.add("2012-10-27 03:00:00",       7.5,       7.5, "0111100000100010", "");
    data.setType(22);
    data.setStation(76926)
        .add("2012-10-27 01:00:00",       7.4,       7.4, "0111100000100010", "")
        .add("2012-10-27 02:00:00",       7.7,       7.7, "0111100000100010", "")
        .add("2012-10-27 03:00:00",       7.4,       7.4, "0111100000100010", "")
        .add("2012-10-27 04:00:00",       8.0,       8.0, "0111100000100010", "")
        .add("2012-10-27 05:00:00",  -32767.0,       8.5, "0000601000000000", "QC1-4-211");
    data.setType(23);
    data.setStation(76926)
        .add("2012-10-27 01:00:00",       7.4,       7.4, "0111100000100010", "")
        .add("2012-10-27 01:10:00",       6.8,       6.8, "0111000000100010", "")
        .add("2012-10-27 01:20:00",       6.8,       6.8, "0111000000100010", "")
        .add("2012-10-27 01:30:00",       6.7,       6.7, "0111000000100010", "")
        .add("2012-10-27 01:40:00",       6.9,       6.9, "0111000000100010", "")
        .add("2012-10-27 01:50:00",       7.4,       7.4, "0111000000100010", "")
        .add("2012-10-27 02:00:00",       7.7,       7.7, "0111100000100010", "")
        .add("2012-10-27 02:10:00",       7.1,       7.1, "0111000000100010", "")
        .add("2012-10-27 02:20:00",       7.0,       7.0, "0111000000100010", "")
        .add("2012-10-27 02:30:00",       7.0,       7.0, "0111000000100010", "")
        .add("2012-10-27 02:40:00",       7.5,       7.5, "0111000000100010", "")
        .add("2012-10-27 02:50:00",       7.4,       7.4, "0111000000100010", "")
        .add("2012-10-27 03:00:00",       7.4,       7.4, "0111100000100010", "")
        .add("2012-10-27 03:10:00",       7.5,       7.5, "0111000000100010", "")
        .add("2012-10-27 03:20:00",       7.6,       7.6, "0111000000100010", "")
        .add("2012-10-27 03:30:00",       7.8,       7.8, "0111000000100010", "")
        .add("2012-10-27 03:40:00",       7.9,       7.9, "0111000000100010", "")
        .add("2012-10-27 03:50:00",       8.0,       8.0, "0111000000100010", "")
        .add("2012-10-27 04:00:00",       8.2,       8.2, "0111100000100010", "")
        .add("2012-10-27 04:10:00",       8.2,       8.2, "0111000000100010", "")
        .add("2012-10-27 05:50:00",       8.0,       8.0, "0111000000100010", "")
        .add("2012-10-27 06:00:00",       8.1,       8.1, "0111100000100010", "");
    ASSERT_NO_THROW(data.insert(db));

    std::stringstream config;
    config << "Start_YYYY = 2012\n"
           << "Start_MM   =   10\n"
           << "Start_DD   =   27\n"
           << "Start_hh   =   01\n"
           << "End_YYYY   = 2012\n"
           << "End_MM     =   10\n"
           << "End_DD     =   27\n"
           << "End_hh     =   06\n"
           << "TypeId     = -32767\n"
           << "Parameter  = par=211,minPar=213,maxPar=215,minVal=-80,maxVal=100,offsetCorrectionLimit=15,fluctuationLevel=0\n";
    AlgorithmConfig params;
    params.Parse(config);
    ASSERT_CONFIGURE(algo, params);

    // too close to time span limits
    // ASSERT_RUN(algo, bc, 1);

    ASSERT_RUN(algo, bc, 0);
}
