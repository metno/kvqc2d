
#include "GapInterpolationTestBase.hh"

TEST_F(GapInterpolationTest, SingleMissingTAXN)
{
    DataList data(2650, 211, 330);
    data.add("2012-10-30 03:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 04:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 06:00:00",      -1.9,      -1.9, "0110000000100010", "");
    data.setStation(3290).setType(342)
        .add("2012-10-30 03:00:00",      -1.4,      -1.4, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -1.5,      -1.5, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(4200).setType(342)
        .add("2012-10-30 03:00:00",      -1.7,      -1.7, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -1.4,      -1.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -1.3,      -1.3, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -3.2,      -3.2, "0111000000100010", "");
    data.setStation(4460).setType(342)
        .add("2012-10-30 03:00:00",      -1.3,      -1.3, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -1.4,      -1.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -3.0,      -3.0, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -5.0,      -5.0, "0111000000100010", "");
    data.setStation(4780).setType(501)
        .add("2012-10-30 03:00:00",      -2.5,      -2.5, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.2,      -2.2, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -2.0,      -2.0, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -3.4,      -3.4, "0111000000100010", "");
    data.setStation(4920).setType(342)
        .add("2012-10-30 03:00:00",      -2.2,      -2.2, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.3,      -2.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(5590).setType(330)
        .add("2012-10-30 03:00:00",      -1.6,      -1.6, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -1.7,      -1.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -1.8,      -1.8, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -2.3,      -2.3, "0111000000100010", "");
    data.setStation(5660).setType(342)
        .add("2012-10-30 03:00:00",      -2.3,      -2.3, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.4,      -2.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(6020).setType(330)
        .add("2012-10-30 03:00:00",      -2.0,      -2.0, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.1,      -2.1, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -2.1,      -2.1, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -2.7,      -2.7, "0111000000100010", "");
    data.setStation(11500).setType(342)
        .add("2012-10-30 03:00:00",      -2.5,      -2.5, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -3.7,      -3.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(17000).setType(330)
        .add("2012-10-30 03:00:00",       1.8,       1.8, "0110000000100010", "")
        .add("2012-10-30 04:00:00",       1.7,       1.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(17150).setType(342)
        .add("2012-10-30 03:00:00",      -0.5,      -0.5, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -0.2,      -0.2, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -0.6,      -0.6, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -1.3,      -1.3, "0111000000100010", "");
    data.setStation(17280).setType(330)
        .add("2012-10-30 03:00:00",       2.0,       2.0, "0110000000100010", "")
        .add("2012-10-30 04:00:00",       1.3,       1.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(17850).setType(330)
        .add("2012-10-30 03:00:00",      -0.6,      -0.6, "0110000000100010", "")
        .add("2012-10-30 04:00:00",      -0.6,      -0.6, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(18210).setType(502)
        .add("2012-10-30 03:00:00",      -1.3,      -1.3, "0101000000100010", "")
        .add("2012-10-30 04:00:00",      -1.1,      -1.1, "0101000000100010", "")
        .add("2012-10-30 05:00:00",      -1.4,      -1.4, "0101000000100010", "")
        .add("2012-10-30 06:00:00",      -2.7,      -2.7, "0101000000100010", "");
    data.setStation(18230).setType(330)
        .add("2012-10-30 03:00:00",      -0.2,      -0.2, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -0.7,      -0.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -1.4,      -1.4, "0111000000100010", "");
    data.setStation(18500).setType(342)
        .add("2012-10-30 03:00:00",      -3.0,      -3.0, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -3.8,      -3.8, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -5.0,      -5.0, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -5.5,      -5.5, "0111000000100010", "");
    data.setStation(18700).setType(330)
        .add("2012-10-30 03:00:00",      -0.6,      -0.6, "0110000000100010", "")
        .add("2012-10-30 04:00:00",      -0.2,      -0.2, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(18950).setType(330)
        .add("2012-10-30 03:00:00",      -4.1,      -4.1, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -5.4,      -5.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -5.9,      -5.9, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -6.0,      -6.0, "0111000000100010", "");
    data.setStation(20301).setType(330)
        .add("2012-10-30 03:00:00",      -3.8,      -3.8, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -4.0,      -4.0, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -5.1,      -5.1, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -6.3,      -6.3, "0111000000100010", "");
    data.setStation(24710).setType(342)
        .add("2012-10-30 03:00:00",      -4.8,      -4.8, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -5.4,      -5.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -7.6,      -7.6, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -8.5,      -8.5, "0111000000100010", "");
    data.setStation(26900).setType(330)
        .add("2012-10-30 03:00:00",      -1.5,      -1.5, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.3,      -2.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(26990).setType(342)
        .add("2012-10-30 03:00:00",      -1.6,      -1.6, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.9,      -2.9, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(27010).setType(330)
        .add("2012-10-30 03:00:00",      -2.6,      -2.6, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -3.7,      -3.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(27270).setType(4)
        .add("2012-10-30 03:00:00",      -0.1,  -32766.0, "0010002000000600", "QC1-0-211")
        .add("2012-10-30 04:00:00",      -1.2,  -32766.0, "0010002000000600", "QC1-0-211")
        .add("2012-10-30 05:00:00",      -1.5,  -32766.0, "0010002000000600", "QC1-0-211");
    data.setStation(27450).setType(330)
        .add("2012-10-30 03:00:00",      -0.3,      -0.3, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -1.4,      -1.4, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(27470).setType(1)
        .add("2012-10-30 03:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 04:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(27500).setType(330)
        .add("2012-10-30 03:00:00",       2.4,       2.4, "0111000000100010", "")
        .add("2012-10-30 04:00:00",       2.2,       2.2, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(28380).setType(330)
        .add("2012-10-30 03:00:00",      -5.9,      -5.9, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -7.3,      -7.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -8.5,      -8.5, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -9.0,      -9.0, "0111000000100010", "");
    data.setStation(28922).setType(330)
        .add("2012-10-30 03:00:00",      -8.6,      -8.6, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -9.1,      -9.1, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -9.5,      -9.5, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -9.4,      -9.4, "0111000000100010", "");
    data.setStation(29950).setType(330)
        .add("2012-10-30 03:00:00",       1.5,       1.5, "0111000000100010", "")
        .add("2012-10-30 04:00:00",       0.9,       0.9, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(30420).setType(311)
        .add("2012-10-30 03:00:00",      -2.0,      -2.0, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -2.3,      -2.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -3.2,      -3.2, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -3.3,      -3.3, "0111000000100010", "");
    data.setStation(30650).setType(311)
        .add("2012-10-30 03:00:00",      -5.9,      -5.9, "0110000000100010", "")
        .add("2012-10-30 04:00:00",      -7.5,      -7.5, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(32060).setType(330)
        .add("2012-10-30 03:00:00",      -3.0,      -3.0, "0111000000100010", "")
        .add("2012-10-30 04:00:00",      -3.7,      -3.7, "0111000000100010", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(34130).setType(330)
        .add("2012-10-30 03:00:00",       0.6,       0.6, "0111000000100010", "")
        .add("2012-10-30 04:00:00",       0.3,       0.3, "0111000000100010", "")
        .add("2012-10-30 05:00:00",      -0.3,      -0.3, "0111000000100010", "")
        .add("2012-10-30 06:00:00",      -0.6,      -0.6, "0111000000100010", "");

    data.setStation(3290).setParam(213).setType(342)
        .add("2012-10-30 03:00:00",      -1.4,      -1.4, "0111000000000000", "")
        .add("2012-10-30 04:00:00",      -1.7,      -1.7, "0111000000000000", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 06:00:00",      -1.3,      -1.3, "0110000000000000", "")
        .setParam(215)
        .add("2012-10-30 03:00:00",      -0.9,      -0.9, "0111000000000000", "")
        .add("2012-10-30 04:00:00",      -1.4,      -1.4, "0111000000000000", "")
        .add("2012-10-30 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-10-30 06:00:00",      -1.1,      -1.1, "0110000000000000", "");
    ASSERT_NO_THROW(data.insert(db));

    std::ostringstream sql;
    INSERT_STATION(sql, 2650, "AURSKOG II",                  59.912, 11.580,  128);
    INSERT_STATION(sql, 3290, "RAKKESTAD",                   59.386, 11.387,  100);
    INSERT_STATION(sql, 4200, "KJELLER",                     59.971, 11.038,  109);
    INSERT_STATION(sql, 4460, "HAKADAL JERNBANESTASJON",     60.117, 10.829,  170);
    INSERT_STATION(sql, 4780, "GARDERMOEN",                  60.206, 11.080,  202);
    INSERT_STATION(sql, 4920, "UDNES",                       60.123, 11.389,  160);
    INSERT_STATION(sql, 5590, "KONGSVINGER",                 60.190, 12.007,  148);
    INSERT_STATION(sql, 5660, "ROVERUD",                     60.252, 12.088,  150);
    INSERT_STATION(sql, 6020, "FLISA II",                    60.614, 12.012,  185);
    INSERT_STATION(sql, 11500, "ØSTRE TOTEN - APELSVOLL",     60.700, 10.868,  264);
    INSERT_STATION(sql, 17000, "STRØMTANGEN FYR",             59.151, 10.829,   10);
    INSERT_STATION(sql, 17150, "RYGGE",                       59.379, 10.775,   40);
    INSERT_STATION(sql, 17280, "GULLHOLMEN",                  59.435, 10.578,   14);
    INSERT_STATION(sql, 17850, "ÅS",                          59.660, 10.782,   89);
    INSERT_STATION(sql, 17980, "OSLO - LJABRUVEIEN",          59.843, 10.824,   92);
    INSERT_STATION(sql, 18210, "OSLO - HOVIN",                59.923, 10.807,  100);
    INSERT_STATION(sql, 18230, "ALNA",                        59.923, 10.834,   90);
    INSERT_STATION(sql, 18500, "BJØRNHOLT",                   60.051, 10.688,  360);
    INSERT_STATION(sql, 18700, "OSLO - BLINDERN",             59.942, 10.720,   94);
    INSERT_STATION(sql, 18815, "OSLO - BYGDØY",               59.905, 10.683,   15);
    INSERT_STATION(sql, 18950, "TRYVASSHØGDA",                59.985, 10.669,  514);
    INSERT_STATION(sql, 20301, "HØNEFOSS - HØYBY",            60.166, 10.248,  140);
    INSERT_STATION(sql, 24710, "GULSVIK II",                  60.383,  9.605,  142);
    INSERT_STATION(sql, 26900, "DRAMMEN - BERSKOG",           59.754, 10.124,    8);
    INSERT_STATION(sql, 26990, "SANDE - GALLEBERG",           59.619, 10.215,   60);
    INSERT_STATION(sql, 27010, "KONNERUD",                    59.713, 10.146,  193);
    INSERT_STATION(sql, 27270, "TØNSBERG - KILEN",            59.278, 10.431,    3);
    INSERT_STATION(sql, 27450, "MELSOM",                      59.230, 10.348,   26);
    INSERT_STATION(sql, 27470, "TORP",                        59.184, 10.255,   88);
    INSERT_STATION(sql, 27500, "FÆRDER FYR",                  59.027, 10.524,    6);
    INSERT_STATION(sql, 28380, "KONGSBERG BRANNSTASJON",      59.625,  9.638,  170);
    INSERT_STATION(sql, 28922, "VEGGLI II",                   60.044,  9.147,  275);
    INSERT_STATION(sql, 29950, "SVENNER FYR",                 58.969, 10.148,   15);
    INSERT_STATION(sql, 30420, "SKIEN - GEITERYGGEN",         59.183,  9.567,  136);
    INSERT_STATION(sql, 30650, "NOTODDEN FLYPLASS",           59.567,  9.210,   20);
    INSERT_STATION(sql, 32060, "GVARV - NES",                 59.383,  9.201,   93);
    INSERT_STATION(sql, 34130, "JOMFRULAND",                  58.856,  9.575,    5);

    INSERT_NEIGHBOR(sql,  3290, 211,  2650,  1.389800,  0.921349,  1.407890);
    INSERT_NEIGHBOR(sql,  3290, 211, 17850,  0.099260,  0.976039,  1.480050);
    INSERT_NEIGHBOR(sql,  3290, 211, 17150, -0.654866,  0.995575,  1.597320);
    INSERT_NEIGHBOR(sql,  3290, 211, 27450, -0.644128,  0.993146,  1.694810);
    INSERT_NEIGHBOR(sql,  3290, 211,  4200,  0.786029,  0.907489,  1.714830);
    INSERT_NEIGHBOR(sql,  3290, 211, 27270, -1.498870,  0.971990,  1.747330);
    INSERT_NEIGHBOR(sql,  3290, 211,  5590,  1.348910,  0.913411,  1.748600);
    INSERT_NEIGHBOR(sql,  3290, 211,  5660,  1.209820,  0.898974,  1.782200);
    INSERT_NEIGHBOR(sql,  3290, 211, 18700, -0.570505,  0.970140,  1.906690);
    INSERT_NEIGHBOR(sql,  3290, 211, 27470, -0.474703,  0.980797,  1.913140);
    INSERT_NEIGHBOR(sql,  3290, 211,  6020,  1.556260,  0.899319,  1.953360);
    INSERT_NEIGHBOR(sql,  3290, 211, 18500,  1.977960,  0.968310,  1.964180);
    INSERT_NEIGHBOR(sql,  3290, 211,  4780,  1.323670,  0.924122,  1.977670);
    INSERT_NEIGHBOR(sql,  3290, 211,  4460,  1.345460,  0.926305,  2.002630);
    INSERT_NEIGHBOR(sql,  3290, 211,  4920,  1.857660,  0.897206,  2.005360);
    INSERT_NEIGHBOR(sql,  3290, 211, 26990,  0.073171,  0.953533,  2.016800);
    INSERT_NEIGHBOR(sql,  3290, 211, 17980,  0.694097,  0.847092,  2.098920);
    INSERT_NEIGHBOR(sql,  3290, 211, 20301,  1.035290,  0.901602,  2.115630);
    INSERT_NEIGHBOR(sql,  3290, 211, 18230,  0.062491,  0.915077,  2.149780);
    INSERT_NEIGHBOR(sql,  3290, 211, 26900,  0.553095,  0.894740,  2.225830);
    INSERT_NEIGHBOR(sql,  3290, 211, 30420, -0.038905,  0.983066,  2.242330);
    INSERT_NEIGHBOR(sql,  3290, 211, 27010,  1.086710,  0.922728,  2.359040);
    INSERT_NEIGHBOR(sql,  3290, 211, 17000, -1.914790,  1.037370,  2.396680);
    INSERT_NEIGHBOR(sql,  3290, 211, 11500,  1.560010,  0.934293,  2.406640);
    INSERT_NEIGHBOR(sql,  3290, 211, 18210, -0.355900,  0.863101,  2.417130);
    INSERT_NEIGHBOR(sql,  3290, 211, 28380,  1.254200,  0.902156,  2.440750);
    INSERT_NEIGHBOR(sql,  3290, 211, 18815, -0.929316,  0.802650,  2.465230);
    INSERT_NEIGHBOR(sql,  3290, 211, 17280, -1.802250,  1.033130,  2.465950);
    INSERT_NEIGHBOR(sql,  3290, 211, 32060,  0.290850,  0.949032,  2.491600);
    INSERT_NEIGHBOR(sql,  3290, 211, 34130, -2.374580,  1.059470,  2.504390);
    INSERT_NEIGHBOR(sql,  3290, 211, 30650,  1.355260,  0.866791,  2.520900);
    INSERT_NEIGHBOR(sql,  3290, 211, 18950,  1.940010,  1.027250,  2.639780);
    INSERT_NEIGHBOR(sql,  3290, 211, 29950, -2.345090,  1.056670,  2.713070);
    INSERT_NEIGHBOR(sql,  3290, 211, 24710,  1.548090,  0.872357,  2.723560);
    INSERT_NEIGHBOR(sql,  3290, 211, 27500, -2.701960,  1.061840,  2.778300);
    INSERT_NEIGHBOR(sql,  3290, 211, 28922,  1.820330,  0.901641,  2.912990);
    ASSERT_NO_THROW_X(db->exec(sql.str()));

    std::stringstream config;
    config << "Start_YYYY = 2012\n"
           << "Start_MM   =   10\n"
           << "Start_DD   =   27\n"
           << "Start_hh   =   06\n"
           << "End_YYYY   = 2012\n"
           << "End_MM     =   10\n"
           << "End_DD     =   30\n"
           << "End_hh     =   06\n"
           << "TypeId     =  342\n"
           << "Parameter = par=211,minPar=213,maxPar=215,minVal=-80,maxVal=100,offsetCorrectionLimit=15,fluctuationLevel=0\n";
    AlgorithmConfig params;
    params.Parse(config);

    ASSERT_CONFIGURE(algo, params);

    // too close to time span limits
    // ASSERT_RUN(algo, bc, 1);

    ASSERT_RUN(algo, bc, 0);
}
