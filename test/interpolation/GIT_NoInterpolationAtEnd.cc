
#include "GapInterpolationTestBase.hh"

TEST_F(GapInterpolationTest, NoInterpolationAtEnd)
{
    std::ostringstream sql;
    sql << "INSERT INTO station VALUES( 9580, 62.270, 10.732, 482.0, 0.0, 'TYNSET - HANSMOEN', 1265, 9580, NULL, NULL, NULL, 8, 't', '2001-07-01 00:00:00');"
        << "INSERT INTO station VALUES(10800, 62.680, 11.817, 760.0, 0.0, 'S�LENDET', 1287, 10800, NULL, NULL, NULL, 8, 't', '2007-10-01 00:00:00');"
        << "INSERT INTO station VALUES(65310, 63.518, 7.947, 5.0, 0.0, 'VEIHOLMEN', 1225, 65310, NULL, NULL, NULL, 8, 't', '2002-07-01 00:00:00');"
        << "INSERT INTO station VALUES(65940, 63.847, 8.467, 5.0, 0.0, 'SULA', 1228, 65940, NULL, NULL, NULL, 8, 't', '1975-01-01 00:00:00');"
        << "INSERT INTO station VALUES(68860, 63.411, 10.454, 127.0, 0.0, 'TRONDHEIM - VOLL', 1257, 68860, NULL, NULL, NULL, 8, 't', '1996-03-01 00:00:00');"
        << "INSERT INTO station VALUES(69380, 63.411, 11.728, 169.0, 0.0, 'MER�KER - VARDETUN', 1293, 69380, NULL, NULL, NULL, 8, 't', '2011-06-28 00:00:00');"
        << "INSERT INTO station VALUES(71850, 64.173, 9.406, 16.0, 0.0, 'HALTEN FYR', 1240, 71850, NULL, NULL, NULL, 8, 't', '1983-09-01 00:00:00');";

    INSERT_NEIGHBOR(sql, 68860, 211,  9580);
    INSERT_NEIGHBOR(sql, 68860, 211, 10800);
    INSERT_NEIGHBOR(sql, 68860, 211, 65310);
    INSERT_NEIGHBOR(sql, 68860, 211, 65940);
    INSERT_NEIGHBOR(sql, 68860, 211, 69380);
    INSERT_NEIGHBOR(sql, 68860, 211, 71850);

    ASSERT_NO_THROW(db->exec(sql.str()));

    DataList data(9580, 211, 330);
    data.add("2012-05-13 21:00:00",       5.1,       5.1, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       5.7,       5.7, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       5.3,       5.3, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       4.2,       4.2, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       4.0,       4.0, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       4.2,       4.2, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       5.3,       5.3, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       5.9,       5.9, "0111000000100010", "")
        .add("2012-05-14 05:00:00",       5.5,       5.5, "0111000000100010", "");
    data.setStation(10800).setType(330)
        .add("2012-05-13 21:00:00",       1.6,       1.6, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       1.4,       1.4, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       1.3,       1.3, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       1.3,       1.3, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       1.6,       1.6, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       1.2,       1.2, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       1.4,       1.4, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       1.8,       1.8, "0111000000100010", "")
        .add("2012-05-14 05:00:00",       2.2,       2.2, "0111000000100010", "");
    data.setStation(65310).setType(330)
        .add("2012-05-13 21:00:00",       9.5,       9.5, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       9.8,       9.8, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       9.3,       9.3, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       9.5,       9.5, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       9.4,       9.4, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       9.4,       9.4, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       9.5,       9.5, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       6.8,       6.8, "0110000000100010", "")
        .add("2012-05-14 05:00:00",       6.6,       6.6, "0111000000100010", "");
    data.setStation(65940).setType(330)
        .add("2012-05-13 21:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       8.7,       8.7, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       9.1,       9.1, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       9.0,       9.0, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       8.7,       8.7, "0111000000100010", "")
        .add("2012-05-14 05:00:00",       6.6,       6.6, "0111000000100010", "");
    data.setStation(68860).setType(330)
        .add("2012-05-13 21:00:00",       9.3,       9.3, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       9.4,       9.4, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       9.3,       9.3, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-14 01:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-05-14 02:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-05-14 03:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-05-14 04:00:00",  -32767.0,  -32767.0, "0000003000000000", "")
        .add("2012-05-14 05:00:00",  -32767.0,  -32767.0, "0000003000000000", "");
    data.setStation(69380).setType(330)
        .add("2012-05-13 21:00:00",       6.0,       6.0, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       5.8,       5.8, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       5.8,       5.8, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       6.4,       6.4, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       5.5,       5.5, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       5.8,       5.8, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       6.6,       6.6, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       7.5,       7.5, "0111000000100010", "")
        .add("2012-05-14 05:00:00",       7.7,       7.7, "0111000000100010", "");
    data.setStation(71850).setType(330)
        .add("2012-05-13 21:00:00",       9.1,       9.1, "0111000000100010", "")
        .add("2012-05-13 22:00:00",       9.0,       9.0, "0111000000100010", "")
        .add("2012-05-13 23:00:00",       9.1,       9.1, "0111000000100010", "")
        .add("2012-05-14 00:00:00",       9.1,       9.1, "0111000000100010", "")
        .add("2012-05-14 01:00:00",       9.0,       9.0, "0111000000100010", "")
        .add("2012-05-14 02:00:00",       8.9,       8.9, "0111000000100010", "")
        .add("2012-05-14 03:00:00",       8.8,       8.8, "0111000000100010", "")
        .add("2012-05-14 04:00:00",       9.1,       9.1, "0111000000100010", "")
        .add("2012-05-14 05:00:00",       9.1,       9.1, "0111000000100010", "");
    ASSERT_NO_THROW(data.insert(db));

    std::stringstream config;
    config << "Start_YYYY = 2012\n"
           << "Start_MM   =    5\n"
           << "Start_DD   =   13\n"
           << "Start_hh   =   21\n"
           << "End_YYYY   = 2012\n"
           << "End_MM     =    5\n"
           << "End_DD     =   14\n"
           << "End_hh     =    8\n"
           << "TypeId     =  330\n"
           << "Parameter  = par=211,minPar=213,maxPar=215,minVal=-80,maxVal=80,offsetCorrectionLimit=15,fluctuationLevel=0.5\n";
    AlgorithmConfig params;
    ASSERT_PARSE_CONFIG(params, config);
    ASSERT_CONFIGURE(algo, params);
    ASSERT_RUN(algo, bc, 0);

    data.setStation(9580).setParam(211).setType(330)
        .add("2012-05-14 06:00:00",       5.5, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       5.5, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       5.5, "0111000000100010", "");
    data.setStation(10800).setType(330)
        .add("2012-05-14 06:00:00",       2.2, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       2.2, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       2.2, "0111000000100010", "");
    data.setStation(65310).setType(330)
        .add("2012-05-14 06:00:00",       6.6, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       6.6, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       6.6, "0111000000100010", "");
    data.setStation(65940).setType(330)
        .add("2012-05-14 06:00:00",       6.6, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       6.6, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       6.6, "0111000000100010", "");
    data.setStation(68860).setType(330)
        .add("2012-05-14 06:00:00",       8.9, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       8.9, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       8.9, "0111000000100010", "");
    data.setStation(69380).setType(330)
        .add("2012-05-14 06:00:00",       7.7, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       7.7, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       7.7, "0111000000100010", "");
    data.setStation(71850).setType(330)
        .add("2012-05-14 06:00:00",       9.1, "0111000000100010", "")
        .add("2012-05-14 07:00:00",       9.1, "0111000000100010", "")
        .add("2012-05-14 08:00:00",       9.1, "0111000000100010", "");
    ASSERT_NO_THROW(data.insert(db));
    ASSERT_RUN(algo, bc, 5);
}
