
#include "GapInterpolationTestBase.hh"

TEST_F(GapInterpolationTest, VeryLittleSnow)
{
    DataList data(4460, 112, 342); // corrected values are mostly fake
    data.add("2012-04-15 00:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 01:00:00",      1.3, "0111000000100010", "")
        .add("2012-04-15 02:00:00",      1.5, "0111000000100010", "")
        .add("2012-04-15 03:00:00",      1.6, "0111000000100010", "")
        .add("2012-04-15 04:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 05:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 06:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 07:00:00", -32767,   "0000003000000000", "")
        .add("2012-04-15 08:00:00", -32767,   "0000003000000000", "")
        .add("2012-04-15 09:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 10:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 11:00:00",     -1,   "0111000000100010", "")
        .add("2012-04-15 12:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 13:00:00",      1.5, "0111000000100010", "")
        .add("2012-04-15 14:00:00",      1.4, "0111000000100010", "")
        .add("2012-04-15 15:00:00",      1.3, "0111000000100010", "")
        .add("2012-04-15 16:00:00",      1.4, "0111000000100010", "")
        .add("2012-04-15 17:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 18:00:00",      1.3, "0111000000100010", "")
        .add("2012-04-15 19:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 20:00:00",      1.1, "0111000000100010", "")
        .add("2012-04-15 21:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 22:00:00",      1.2, "0111000000100010", "")
        .add("2012-04-15 23:00:00",      1.2, "0111000000100010", "");
    ASSERT_NO_THROW(data.insert(db));

    std::stringstream config;
    config << "Start_YYYY = 2012\n"
           << "Start_MM   =   04\n"
           << "Start_DD   =   15\n"
           << "Start_hh   =    0\n"
           << "End_YYYY   = 2012\n"
           << "End_MM     =   04\n"
           << "End_DD     =   16\n"
           << "End_hh     =    0\n"
           << "TypeId     =  342\n"
           << "Parameter = par=112,minVal=0,offsetCorrectionLimit=15\n";
    AlgorithmConfig params;
    ASSERT_PARSE_CONFIG(params, config);
    ASSERT_CONFIGURE(algo, params);

    // cannot interpolate as there are only -1 before and after the gap; there is
    // no numerical equivalent for -1 (could be "not reported" or "very little")
    ASSERT_RUN(algo, bc, 0);

    data.setStation(4460).setParam(112).setType(342)
        .add("2012-04-15 06:00:00",    0.0,   "0111000000100010", "")
        .add("2012-04-15 09:00:00",    0.0,   "0111000000100010", "");
    ASSERT_NO_THROW(data.insert(db));
    ASSERT_RUN(algo, bc, 2);

    ASSERT_RUN(algo, bc, 0);
}
